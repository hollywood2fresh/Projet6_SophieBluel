const loginForm = document.getElementById('login');

loginForm.addEventListener('submit', (event) => {
  event.preventDefault();
  let baliseEmail = document.getElementById('email');
  let baliseMotDePasse = document.getElementById('password');
  let email = baliseEmail.value;
  let motDePasse = baliseMotDePasse.value;
login(email, motDePasse)
})


async function login(email, motDePasse) {
  let user = {
    email: email,
    password: motDePasse
  };
  let response = await fetch('http://localhost:5678/api/users/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(user)
  }); 
  
  let result = await response.json();







  const errorForm = document.getElementById('login') // loginForm
  const errorLabelEmail = document.getElementById('label-email')
  const errorEmail = document.getElementById('email')
  const errorLabelPassword = document.getElementById('label-password')
  const errorPassword = document.getElementById('password')
    // Création balises error 
  const errorChampsObligatoire = document.createElement('p')
  const errorIncorrecte = document.createElement('p')
    // Ajout au formulaire 
  errorForm.append(errorChampsObligatoire)
  errorForm.prepend(errorIncorrecte)

  console.log(email);

  if(user.email === '' || user.password === '') {
      if(user.email === '') {
      errorLabelEmail.classList.add('js-errorForm')
      errorEmail.classList.add('js-errorForm')
      errorChampsObligatoire.classList.add('js-errorChampsObligatoire')
      errorChampsObligatoire.innerHTML = '<i class="fa-solid fa-circle-exclamation"></i>Tous les champs sont obligatoires.'
      addEventListener('click', () => {
        errorLabelEmail.classList.remove('js-errorForm')
        errorEmail.classList.remove('js-errorForm')
        errorChampsObligatoire.classList.remove('js-errorChampsObligatoire')
        errorChampsObligatoire.innerHTML = ''
      })
    }
    if(user.password === '') {
      errorLabelPassword.classList.add('js-errorForm')
      errorPassword.classList.add('js-errorForm')
      errorChampsObligatoire.classList.add('js-errorChampsObligatoire')
      errorChampsObligatoire.innerHTML = '<i class="fa-solid fa-circle-exclamation"></i>Tous les champs sont obligatoires.'
      addEventListener('click', () => {
        errorLabelPassword.classList.remove('js-errorForm')
        errorPassword.classList.remove('js-errorForm')
        errorChampsObligatoire.classList.remove('js-errorChampsObligatoire')
        errorChampsObligatoire.innerHTML = ''
      })
    } 
  } else if(response.ok === false) {
      errorIncorrecte.classList.add('js-errorIncorrecte')
      errorIncorrecte.innerHTML = '<i class="fa-solid fa-circle-exclamation"></i>Merci de réessayer<br><span>E-mail ou mot de passe incorrectes</span>'
  } else {
      // window.location.assign('./index-edit.html')
      localStorage.setItem('token', result.token)
      localStorage.setItem('userId', result.userId)
  }





}


  // let erreur = document.getElementById('erreur')
  // if(response.ok === false) {
  //   erreur.innerHTML = 'Identifiant ou mot de passe incorrect'
  // } else {
  //   window.location.assign('./index-edit.html')
  //   localStorage.setItem('token', result.token)
  //   localStorage.setItem('userId', result.userId)
  // }





  // // Création balises error 
  // const errorChampsObligatoire = document.createElement('p')
  // const errorIncorrecte = document.createElement('p')
  // // Ajout class
  // errorChampsObligatoire.classList.add('js-errorChampsObligatoire')
  // errorIncorrecte.classList.add('js-errorIncorrecte')
  // labelEmail.classList.add('js-errorForm')
  // email.classList.add('js-errorForm')
  // labelPassword.classList.add('js-errorForm')
  // password.classList.add('js-errorForm')
  

  // // Ajout au formulaire 
  // form.append(errorChampsObligatoire)
  // form.prepend(errorIncorrecte)

  // errorChampsObligatoire.innerHTML = '<i class="fa-solid fa-circle-exclamation"></i>Tous les champs sont obligatoires.'
  // errorIncorrecte.innerHTML = '<i class="fa-solid fa-circle-exclamation"></i>Merci de réessayer<br><span>E-mail ou mot de passe incorrectes</span>'






// document.getElementById('login').addEventListener('submit', function(e) { 
    

//     let erreur;

//     if(erreur) {
//         e.preventDefault(); // empecher le comportement par default du formulaire 
//         document.getElementById('erreur').innerHTML = erreur;
//         return false;
//     } else {
//         alert('formulaire envoyé !!')
//     }

//     // let email = document.getElementById('email');
//     // let motDePasse = document.getElementById('password');

    
//     // if(!motDePasse.value) {
//     //     erreur = "Veuillez renseigner votre mot de passe";
//     // }
//     // if(!email.value) {
//     //     erreur = "Veuillez renseigner votre e-mail";
//     // }
    
   
// })

// let users = {
//     name: 
// }

// async function postData(url = '', data = {}) {
//     const response = await fetch('http://localhost:5678/api/users', {
//         method: 'POST'
//         headers: {
//             'Content-Type': 'application/json'
//         }
//         body: JSON.stringify(data)
//     });
//     return response.json();
// }

// let user = {
//     name: 'John',
//     surname: 'Smith'
//   };
  
//   let response = await fetch('http://localhost:5678/api/users/login', {
//     method: 'POST',
//     headers: {
//       'Content-Type': 'application/json'
//     },
//     body: JSON.stringify(user)
//   });
  
//   let result = await response.json();
//   alert(result.message);

//   console.log(user);